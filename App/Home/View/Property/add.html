<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>添加开发商</title>
        <link href="__PUBLIC__/Css/style.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" type="text/css" href="__PUBLIC__/Js/jquery-ui/css/pepper-grinder/jquery-ui.min.css">
            <!-- <link href="__PUBLIC__/Css/select.css" rel="stylesheet" type="text/css" /> -->
            <script type="text/javascript" src="__PUBLIC__/Js/jquery.js"></script>
            <script type="text/javascript" src="__PUBLIC__/Js/common.js"></script>
            <link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/bootstrap.min.css">
                <script src='__PUBLIC__/Js/jquery.uploadify.min.js'></script>
                <script type="text/javascript">
                    $(function(){
                        if($("#action").val()=='edit'){
                            $("#adminName").remove();
                            $("#password").remove();
                            $(".removeUser").remove()
                        }
                        function setout(){
                            $('.validateTips').text()
                            $('#skuNotice').show();
                            var dingshi= setTimeout( function(){
                                $( '#skuNotice' ).fadeOut();
                            }, ( 1 * 1000 ) );  
                            return dingshi;
                        } 
                        function checkInput(){
                            var bValid = true;
                            bValid = bValid && checkLength( $("#pname"), "物业名称", 2, 16 );
                            bValid = bValid && checkEmpty( $("#addressAdd"), "请选择省市！" );
                            //                bValid = bValid && checkEmpty( $("#city_list"), "请选择市区！" );
                            bValid = bValid && checkEmpty( $("#val_list"), "请选择区县！" );
                            bValid = bValid && checkEmpty( $("#address"), "详细地址不能为空！" );
                            bValid = bValid && (checkRegexp( $("#phone"), /\d{3}-\d{8}|\d{4}-\d{7}/ , "电话格式不正确！" ));
                            bValid = bValid && checkEmpty( $("#manager"), "详细地址不能为空！" );
                            bValid = bValid && (checkRegexp( $("#manage_phone"), /(^1[0-9]{10}$)|(^00[1-9]{1}[0-9]{3,15}$)/ , "手机格式不正确！" ));
                            if($("#action").val()=='add'){
                                bValid = bValid && checkLength( $("#adminName"), "管理员用户名", 2, 16 );
                                bValid = bValid && checkLength( $("#password"), "\u5bc6码", 6, 16 )
                            }
                           
                           if(bValid==false){ setout(); }
                            return bValid;
                        }
                        $('form').submit(function(){
                            if(!checkInput()){
                                $('.dfinput').each(function () {
                                    if($(this).val()==''){
                                        $(this).next().css("color","red");
                                        $('.errorColor').css("color","red")
                                    }
                                });
                                return false;
                            }
                            return true
                        })
                        $('#village_id').bind('change',function(){
                            $(this).parent().next().css("color","#7f7f7f")
                        })
                        $(".dfinput").bind("focus",function(){
                            $('#skuNotice').hide();
                            $(this).addClass("focus");
                            $(this).next().css("color","#7f7f7f");
                            if($(this).hasClass("ui-state-error")){
                                $(this).removeClass( "ui-state-error" );
                                $(".validateTips").removeClass("errorTip").hide();	
                            }
                        }).bind("blur",function(){
                            $(this).removeClass("focus");
                            if($(this).val()==''){ 
                                $(this).next().css("color","red"); }
                            checkInput();
                        });
                    })
                </script>
                </head>
                <style type="text/css">
                    .pro{  float: left;line-height: 30px;margin-bottom: 10px; margin-left: 0px; }
                    .sku_tip { background: none repeat scroll 0 0 rgba(0, 0, 0, 0.7);border-radius: 4px;box-shadow: 0 0 3px 3px rgba(150, 150, 150, 0.7);color: #fff;display: none;left: 50%;margin-left: -70px; padding: 5px 10px;position: fixed; text-align: center; top: 50%;z-index: 25;}
                    .pro select{width: 345px;height: 32px; }
                    .info_start{ color: red;}
                    /*#val_list{width: 345px;height: 32px;  margin-left: 85px;} -*/
                </style>

                <body style="background: none;">

                    <div class="place">
                            <span>位置： </span>
                        <ul class="placeul">
                            <!--<li>位置：</li> -->
                            <li><a href="{:U('Index/start','','')}">首页</a></li>
                            <li><a href="__CONTROLLER__">物业管理</a></li>
                            <li>添加物业</li>
                        </ul>
                    </div>
                    <form action="" method="post" name ="vform">
                        <input type ="hidden" name="id" value="{$info.id}">
                            <input type ="hidden" name="action" value="{$data.action}" id="action">
                                <input type ="hidden" name="admin" value={$Think.session.admin.name}>
                                    <div class="formbody">

                                        <div class="formtitle"><span>{$data.title}</span></div>

                                        <ul class="forminfo">
                                            <li><label>物业名称<a class="info_start">&nbsp; *</a></label><input name="pname" id="pname" type="text" class="dfinput" value="{$info.pname}" /><i id="name_info">名称不能超过30个字符</i></li>
                                            <li><label>地 址<a class="info_start">&nbsp; *</a></label>
                                                <span class = 'pro'>
                                                    <select name = 'province'  class="form-control" id="addressAdd" >
                                                        <option class="cheng_in" value="{$region.REGION_ID}">{$region.REGION_NAME}</option>
                                                        <volist name='pro' id = "vo">
                                                            <option class = "pro_in" value="{$vo.REGION_ID}" >{$vo.REGION_NAME}</option>
                                                        </volist>
                                                    </select>

                                                    <select name = 'city' style="display:none" id ="city_list" class="form-control" <!--onclick="saveCity()" -->>
                                                            <option class = "city_in" value="{$info.city}"></option>
                                                    </select>

                                                    <select name = 'area' style="display:none"  id ="val_list" class="form-control"  >
                                                        <option class="area_on" value="{$info.area}"></option>
                                                    </select>

                                                </span> <i class="errorColor">请选择地址</i></li>
                                            <li><label>详细地址 <a class="info_start">&nbsp; *</a></label><input name="address" id="address" type="text" class="dfinput" value="{$info.address}" /><i id="address_info">请选择地址</i></li>
                                            <li><label>物业电话<a class="info_start">&nbsp; *</a></label><input name="phone" type="text" id="phone" class="dfinput" value="{$info.phone}" /><i>格式：0755-xxxxzz</i></li>
                                            <li><label>主管名字<a class="info_start">&nbsp; *</a></label><input name="manager" type="text" id="manager" class="dfinput"  value="{$info.manager}"/><i>不能为空</i></li>
                                            <li><label>主管电话<a class="info_start">&nbsp; *</a></label><input name="manage_phone" id="manage_phone" type="text" class="dfinput"  value="{$info.manage_phone}"/><i>格式：134xxxxxxxx</i></li>
                                            <li class="removeUser"><label>管理员用户名<a class="info_start">&nbsp; *</a></label><input name="adminName" id="adminName" type="text" class="dfinput" /><i>管理员用户名不能为空</i></li>
                                            <li class="removeUser"><label>密码<a class="info_start">&nbsp; *</a></label><input name="password" id="password" type="password" class="dfinput"  /><i>管理员密码不能为空</i></li>
                                            <input name="staue" value="0" type="hidden"  />
                                            <input name="add_time" value="0" type="hidden"  />
                                            <!-- <li><label>所属楼盘</label>
                                                     <span class = 'pro'>
                                                     <select  class="form-control" id="property_id" name = 'property_id' style="width: 345px;height: 32px;" >
                                                         <option name = 'property_id' class="pro_into"  value="{$housefin.id}">{$housefin.name}</option>
                                                         <volist name='hlist' id = "list">
                                                             <option name = 'property_id'  value="{$list.id}">{$list.name}</option>
                                                         </volist>
                                                     </select>
                                                 </span>  <i class="errorColor">请选择楼盘</i> -->

                                            <li><label>&nbsp;</label><input name="" type="submit" class="btn btn-primary" value="确认{$data.btn}"  onclick="javascript:;" /></li>
                                        </ul>
                                        <div style="display:none" id="skuNotice" class="sku_tip">
                                            <span class="validateTips"></span>
                                        </div>
                                    </div>
                                    </form>
                                    <script type="Text/Javascript">
                                        $(function(){
                                            //   alert($('.area_on').val())
                                            if($(".pro_into").val()==''){ $(".pro_into").text("请选择"); }
                                            if($(".cheng_in").val()==''){ $(".cheng_in").text("请选择"); }
                                            $('#addressAdd').bind('change',function(){
                                                $('#vallage').hide(200);
                                                var id =$(this).val();
                                                // alert(0);
                                                $('#city').attr('pro',id);
                                                $('#val_list').html("<p>请选择城市</p>")
                                                $.ajax({
                                                    url : "{:U('City/city','','')}",
                                                    type : "post",
                                                    data : "id="+id,
                                                    dataType : "json",
                                                    success : function(data){                   
                                                        if(data != null){
                                                                                                                                                                   
                                                            var str=""
                                                            $.each(data,function(key,val){
                                                                str += "<option class='city_in' value="+val['REGION_ID']+" onclick='javascript:getvallage("+val['REGION_ID']+")'>"+val['REGION_NAME']+"</option>";
                                                            })
                                                            //   $('#city_list').append(str)
                                                            $('#city_list').html(str);
                                                            $('#city_list').show(200);
                                                        }
                                                    }
                                                });         
                                            })
                                                                                                                                                    
                                            $('#city_list').bind('change',function(){
                                                $(this).parent().next().css("color","#7f7f7f")
                                                var id=$(this).val();
                                                                                                                                                        
                                                $.ajax({
                                                    url : "{:U('City/city','','')}",
                                                    type : "post",
                                                    data : "id="+id,
                                                    dataType : "json",
                                                    success : function(data){        
                                                        //   alert(2)                                                                                            
                                                        if(data != null){
                                                            $("#val_list .city_in").remove();
                                                            if($(".city_in").val()!==''){
                              
                                                                var str=""
                                                                var inex= this//selected=selected
                                                                                                                                                                      
                                                                $.each(data,function(key,val){
                                                                    str += "<option class='city_in' value="+val['REGION_ID']+" onclick='javascript:getvallage("+val['REGION_ID']+")'>"+val['REGION_NAME']+"</option>";
                                                                })
                                      
                                                                if(str==''){$('#val_list').hide(200);}else{ $('#val_list').append(str); $('#val_list').show(200);}
                                                            }
                                                        }
                                                    }
                                                                                                                                                              
                                                });  
                                            })                                                                                                                                         
                                            var province = function() {
                                                var id=$(".city_in").val();
                                                $.ajax({
                                                    url : "{:U('City/citySave','','')}",
                                                    type : "post",
                                                    data : "id="+id,
                                                    dataType : "json",
                                                    success : function(data){    
                                                        //  console.log(data)
                                                        if(data != null){
                                                            if($(".cheng_in").val()!==''){
                                                                var str=""
                                                                str += "<option value="+data.REGION_ID+">"+data.REGION_NAME+"</option>";
                                                                $.each(data.list,function(key,val){
                                                                    str += "<option class='city_in' value="+val['REGION_ID']+" onclick='javascript:getvallage("+val['REGION_ID']+")'>"+val['REGION_NAME']+"</option>";
                                                                })
                                                                $('#city_list').html(str);
                                                                $('#city_list').show(200);
                                                            }
                                                        }
                                                    }
                                                });  
                                            };
                                            var area = function() {
                                          
                                                var id=$(".area_on").val();
                                                $.ajax({
                                                    url : "{:U('City/vallcage','','')}",
                                                    type : "post",
                                                    data : "id="+id,
                                                    dataType : "json",
                                                    success : function(data){      
                                                        if(data != null){
                                                            if($(".city_in").val()!==''){
                                                                var str=""
                                                                str += "<option value="+data.REGION_ID+">"+data.REGION_NAME+"</option>";
                                                                $.each(data.list,function(key,val){
                                                                    str += "<option class='city_in' value="+val['REGION_ID']+">"+val['REGION_NAME']+"</option>";
                                                                })
                                                                $('#val_list').html(str);
                                                                $('#val_list').show(200);
                                                            }
                                                        }
                                                    }
                                                });  
                                            };
                                                                                                                                              
                                            province();
                                            area();
 
                                        })
                                        function getvallage(id){
                                               console.log(id)   
                                            var id = id;
                                            $('#vallage').attr('city',id);
                                            $.ajax({
                                                url : "{:U('City/vallage','','')}",
                                                type : "post",
                                                data : "id="+id,
                                                dataType : "json",
                                                success : function(data){                       
                                                    if(data != null){
                                                      
                                                        var str=""
                                                        $.each(data,function(key,val){
                                                            str += "<option class='city_in' value="+val['REGION_ID']+">"+val['REGION_NAME']+"</option>";
                                                        })
                                                        $('#val_list').html(str);
                                                        $('#val_list').show(200);
                                                    }
                                                }
                                            });

                                        }

                                    </script>
                                    </body>

                                    </html>
